i#---------------------------------------------------------------------
# Global settings
#---------------------------------------------------------------------
global
    log         127.0.0.1 local2
    pidfile     /var/run/haproxy.pid
    maxconn 2000
    daemon

#---------------------------------------------------------------------
# common defaults that all the 'listen' and 'backend' sections will 
# use if not designated in their block
#---------------------------------------------------------------------
defaults
    log         global
    option      dontlognull
    option      redispatch
    timeout connect 10000 # default 10 second time out if a backend is not found
    timeout client 300000
    timeout server 300000
    maxconn     60000
    retries     3

frontend http-in
    bind *:80
    mode http
    option  httpclose
    option  httplog
    option      forwardfor
    redirect scheme https code 301 if !{ ssl_fc }

frontend https-in
    bind *:443
    acl is_prod   hdr_dom(host) -i www.centralsquareofmetuchen.com
    acl is_dev    hdr_dom(host) -i dev.centralsquareofmetuchen.com
    acl is_qa     hdr_dom(host) -i qa.centralsquareofmetuchen.com
    use_backend dev   if is_dev
    use_backend qa    if is_qa
    use_backend prod  if is_prod
    default_backend  prod

backend dev
    balance roundrobin
    option log-health-checks
    server devsvr1 127.0.0.1:6443 check

backend qa
    balance roundrobin
    option log-health-checks
    server qasvr1 127.0.0.1:7443 check

backend prod
    balance roundrobin
    option log-health-checks
    server prodsvr1 127.0.0.1:8443 check

listen stats
  bind :8044 # Blocked
  mode http
  stats enable
  timeout connect 10s
  timeout client 1m
  timeout server 1m
  stats hide-version
  stats realm Haproxy\ Statistics
  stats uri /
  stats auth stats:SMqzeA5GJIYs

